appId: com.qshield.desktop
productName: QShield Desktop
copyright: "Copyright © 2026 QShield"

directories:
  output: dist-package
  buildResources: resources

# === macOS ===
mac:
  category: public.app-category.utilities
  icon: resources/icon.png
  target:
    - dmg
    - zip
  hardenedRuntime: true
  gatekeeperAssess: false
  entitlements: resources/entitlements.mac.plist
  entitlementsInherit: resources/entitlements.mac.inherit.plist
  # Notarization — requires Apple Developer account
  # Uncomment when you have credentials:
  # notarize:
  #   teamId: YOUR_TEAM_ID

dmg:
  title: "QShield Desktop"
  icon: resources/icon.png
  contents:
    - x: 130
      y: 220
    - x: 410
      y: 220
      type: link
      path: /Applications
  window:
    width: 540
    height: 380

# === Windows ===
win:
  icon: resources/icon.png
  target:
    - target: nsis
      arch:
        - x64
  # Code signing — uncomment when you have a certificate:
  # certificateFile: certs/windows-cert.pfx
  # certificatePassword: ${WIN_CSC_KEY_PASSWORD}

nsis:
  oneClick: false
  perMachine: false
  allowToChangeInstallationDirectory: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  shortcutName: "QShield Desktop"
  uninstallDisplayName: "QShield Desktop"
  license: resources/license.txt

# === Linux ===
linux:
  icon: resources/icon.png
  target:
    - AppImage
    - deb
  category: Utility
  synopsis: "Trust monitoring and evidence protection"
  description: "QShield Desktop monitors your digital trust across email, files, meetings, and more."

# === Auto Update ===
publish:
  provider: github
  owner: Homatch-AI
  repo: qshield
  releaseType: release

# === Native rebuild ===
# Disable @electron/rebuild — native deps (better-sqlite3) are built
# during pnpm install via node-gyp. Rebuild traverses pnpm workspace
# symlinks and fails on missing devDependencies in sibling packages.
npmRebuild: false

# === Files ===
# Vite bundles everything into dist/ — we only need the built output
# plus node_modules for native addons (better-sqlite3).
# Exclude workspace symlinks (@qshield/core) which point outside
# the package root and break asar packing.
files:
  - dist/**/*
  - "!dist/electron"
  - dist/electron/main.js
  - dist/electron/preload.js
  - dist/electron/preload.cjs
  - dist/electron/exec-daemon.js
  - "!**/*.map"
  - "!**/node_modules/.cache"
  - "!**/node_modules/@qshield/**"
  - "!**/.turbo"

# === Extra files to include ===
extraResources:
  - from: resources/
    to: resources/
    filter:
      - "**/*"
      - "!*.psd"
      - "!*.ai"

# === asar ===
asar: true
asarUnpack:
  - "**/*.node"
  - "**/node_modules/better-sqlite3/**"
  - "**/node_modules/chokidar/**"
